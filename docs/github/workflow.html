<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>github を用いた開発フローテンプレート</title>

    <link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/syntax.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
    <link href='http://fonts.googleapis.com/css?family=Ledger' rel='stylesheet' type='text/css'>
  </head>

  <body class="docs docs_github docs_github_workflow">
    <div id="wrapper">
      <h1>github を用いた開発フローテンプレート</h1>

<h2>Development(開発の進め方)</h2>

<p>GitHub Flow に準ずる</p>

<ul>
<li>masterブランチは常にデプロイ可能な状態としなければならない

<ul>
<li>テストが失敗する状態にある場合は直ちに修正するべきである</li>
<li>テストが通っていない状態の場合、デプロイすることは許されない</li>
</ul></li>
<li>新しい何かに取り組む際は、 pull request を用いるべきである

<ul>
<li>ブランチは master から作成し、ブランチ名は説明的な名前とすべきである（例: new-oauth2-scopes, fix-wrong-classname）</li>
<li>作成したブランチにローカルでコミット後、ただちに github に push し タイトルに [WIP] と付けた pull request を作成しなければならない</li>
<li>pull request 作成時に完了条件をチェックボックスで書くべきである(例: テストコード、モデルの修正、ビューの文言の修正)</li>
<li>pull request 作成時に「pull request が解決する内容」を書くべきである(例: クエリの最適化により、○○画面の表示速度が改善される、画像の差し替えにより広告のクリック率改善が見込める)</li>
<li>半日に一度は作業内容を push するべきである、なお、終業時には必ず push しなければならない</li>
</ul></li>
<li>pull request はレビューされていなければならない

<ul>
<li>レビューアを github のメンションを用いて指定しなければならない</li>
<li>レビューアにレビューしてもらいたい内容を書かなければらない(例: 変更したクエリが本番でも問題無く動くか、リニューアルした画面の配色が違和感ないか)</li>
<li>レビューアがコメントを行い、レビューイが確認と反映を行う</li>
<li>レビューアとレビューイのお互いが納得した状態になれば、あなたはコードを master へマージすることができる</li>
</ul></li>
<li>マージをして master へ push したら、デプロイを行う</li>
</ul>

<h2>Testing(テスト)</h2>

<ul>
<li>デベロッパーテストはプロジェクトごとに方針を決定する</li>
<li>本番リリースをする前に開発環境(integration)、ステージング環境(staging)の両方で動作テストを行うべきである

<ul>
<li>緊急時は例外的に staging のみの動作テストも許可する</li>
</ul></li>
<li>バックグラウンドジョブに変更を加えた場合は、ジョブワーカーを使用している箇所全ての動作テストを行わなければならない</li>
</ul>

<h2>Deployment(リリースの仕方)</h2>

<ul>
<li>デプロイは pull request の作成者が行う

<ul>
<li>デプロイ前に前回のリリースとの差分をチェックしなければならない</li>
<li>差分に自分が把握していない、意図しない変更が含まれている場合は関係者に確認しなければならない、この場合、必要に応じてデプロイ担当を変更すべきである</li>
</ul></li>
<li>デプロイは capistrano もしくは webistrano を用いるべきである</li>
<li>デプロイ実行前に IRC で &ldquo;何処に&rdquo; &ldquo;何を&rdquo; デプロイするのかを宣言しなければならない

<ul>
<li>インフラメンバーに関係ある変更を加える場合は、IRC でメンションを行わなければならない</li>
<li>デプロイを実行するには、自分以外のメンバー、インフラメンバーからの返事を確認しなければならない</li>
</ul></li>
</ul>

<h2>Releases(リリース後の記録)</h2>

<ul>
<li>production へデプロイした際に <code>release-20131010-1504</code> のような形式で自動的にタグを作成されるようにすべきである</li>
<li>自動で作成されたタグは Releases に追加記載される

<ul>
<li>Releases に リリースノート(変更内容を人間が読める形にしたもの)をデプロイした本人が作成すべきである</li>
</ul></li>
<li>リリース後は analytics, newrelic, kibana 等を用いて、新しい何かのリリースによって、発生した変化を必ず確認すべきである

<ul>
<li>pull request または該当する issue に結果を記録すべきである</li>
</ul></li>
</ul>

<h3>Release&rsquo;s notes の作成方法</h3>

<ol>
<li>対象のタグページを開き、右上の <code>Edit tag</code> ボタンをクリックする</li>
<li><code>Release title</code> にタグと同じ名前を入力する</li>
<li><code>Describe this release</code> に、このリリースでデプロイされた機能や修正を記載する(Issue や Pull Request の URL を一緒に記載するとよい)</li>
<li><code>Publish release</code> ボタンをクリックする</li>
</ol>

    </div>
  </body>
</html>
